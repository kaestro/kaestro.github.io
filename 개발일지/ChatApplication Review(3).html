<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/9d2484721dfb0fa3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9d2484721dfb0fa3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d837742cb9035689.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d837742cb9035689.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-35b92941fc8726f9.js" defer=""></script><script src="/_next/static/chunks/framework-381da54bc5986544.js" defer=""></script><script src="/_next/static/chunks/main-d08cdb1c11d062c5.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e6411096b10c6b62.js" defer=""></script><script src="/_next/static/chunks/441-45d334119e93ce4f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bcategory%5D/%5Btitle%5D-54be7db8139f8b64.js" defer=""></script><script src="/_next/static/4n-fl_RCrq53WZFFUxusB/_buildManifest.js" defer=""></script><script src="/_next/static/4n-fl_RCrq53WZFFUxusB/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><header class="page-header"><h1 class="project-name">ChatApplication Review(3)</h1><h1 class="project-subtitle">팀원 모집, 확장성 높은 디자인, CI/CD</h1></header><main id="content" class="main-content"><div><aside id="category-list" aria-label="Category List"><h2>Categories</h2><ul><li><a href="/ETC">ETC</a></li><li><a href="/개발이야기">개발이야기</a></li><li><a href="/개발일지">개발일지</a></li><li><a href="/디자인패턴">디자인패턴</a></li><li><a href="/Algorithm">Algorithm</a></li><li><a href="/서평">서평</a></li><li><a href="/WeeklyPosts">WeeklyPosts</a></li><li><a href="/신변잡기">신변잡기</a></li><li><a href="/게임이야기">게임이야기</a></li></ul></aside><div>
      <h2 id="목차">
        <a name="목차" class="anchor" href="#목차">
          <span class="header-link"></span>
        </a>
        목차
      </h2><ol>
<li>느낀 점</li>
<li>진행 내용</li>
<li>문제 및 해결 방법</li>
</ol>
<hr>

      <h2 id="느낀-점">
        <a name="느낀-점" class="anchor" href="#느낀-점">
          <span class="header-link"></span>
        </a>
        느낀 점
      </h2><hr>

      <h2 id="진행-내용">
        <a name="진행-내용" class="anchor" href="#진행-내용">
          <span class="header-link"></span>
        </a>
        진행 내용
      </h2><ul>
<li>추가 진행에서 협업할 인원 모집</li>
<li>채팅 기능을 위한 모듈들의 작성</li>
<li>설계 조건 맞추기 위한 이론적인 구상</li>
<li>협업을 위한 환경 설정</li>
</ul>
<hr>

      <h2 id="문제-및-해결-방법">
        <a name="문제-및-해결-방법" class="anchor" href="#문제-및-해결-방법">
          <span class="header-link"></span>
        </a>
        문제 및 해결 방법
      </h2>
      <h3 id="문제-요구-스펙-관련해서-redis와-같은-세션을-여러개-사용해야할-가능성이-높다는-것을-확인">
        <a name="문제-요구-스펙-관련해서-redis와-같은-세션을-여러개-사용해야할-가능성이-높다는-것을-확인" class="anchor" href="#문제-요구-스펙-관련해서-redis와-같은-세션을-여러개-사용해야할-가능성이-높다는-것을-확인">
          <span class="header-link"></span>
        </a>
        문제 요구 스펙 관련해서 Redis와 같은 세션을 여러개 사용해야할 가능성이 높다는 것을 확인
      </h3><ul>
<li>RedisStore가 고정적으로 하나의 Redis와의 연결만을 생성할 수 있었음.</li>
</ul>

      <h3 id="해결-방법">
        <a name="해결-방법" class="anchor" href="#해결-방법">
          <span class="header-link"></span>
        </a>
        해결 방법
      </h3><ul>
<li>StoreFactory를 만들고, RedisStoreFactory를 분리.</li>
<li>RedisStoreFactory가 추후에 여러가지 Redis연결을 생성하는 것이 용이하도록 구성함.</li>
</ul>
<pre><code class="language-go">type RedisStoreFactory struct{}

func (factory *RedisStoreFactory) Create(sessionTypeNum SessionType) SessionStore {
    var store SessionStore
    if sessionTypeNum == LoginSession {
        redisAddr := os.Getenv(&quot;REDIS_ADDR&quot;)
        if redisAddr == &quot;&quot; {
            redisAddr = &quot;localhost:6379&quot; // default value
        }

        store = &amp;RedisStore{
            client: redis.NewClient(&amp;redis.Options{
                Addr:     redisAddr,
                Password: &quot;redisPassword&quot;, // no password set
                DB:       0,               // use default DB
            }),
        }
    } else if sessionTypeNum == OtherSession {
        panic(&quot;Unauthorized session type number given to RedisStoreFactory.&quot;)
    }
    return store
}
</code></pre>
<hr>

      <h3 id="문제:-여러가지-측면에서-다른-사람의-도움이-있으면-속도가-빨라질-것-같다는-생각이-듬">
        <a name="문제:-여러가지-측면에서-다른-사람의-도움이-있으면-속도가-빨라질-것-같다는-생각이-듬" class="anchor" href="#문제:-여러가지-측면에서-다른-사람의-도움이-있으면-속도가-빨라질-것-같다는-생각이-듬">
          <span class="header-link"></span>
        </a>
        문제: 여러가지 측면에서 다른 사람의 도움이 있으면 속도가 빨라질 것 같다는 생각이 듬
      </h3><ol>
<li>설계적인 측면에서 second opinion이 필요함.</li>
<li>코드 리뷰를 통해 유지보수성을 높일 필요가 있음.</li>
<li>작성해야하는 코드의 양이 많아짐.</li>
</ol>

      <h3 id="해결-방법">
        <a name="해결-방법" class="anchor" href="#해결-방법">
          <span class="header-link"></span>
        </a>
        해결 방법
      </h3><ul>
<li>커뮤니티에 모집글을 게시</li>
<li>연락이 온 사람과 화상 미팅 진행<ul>
<li>2명 모집.</li>
<li>일주일간 진행해보고 계속할 지 여부에 대해 결정하기로 함.</li>
</ul>
</li>
</ul>
<hr>

      <h3 id="문제:-협업을-위한-환경-설정">
        <a name="문제:-협업을-위한-환경-설정" class="anchor" href="#문제:-협업을-위한-환경-설정">
          <span class="header-link"></span>
        </a>
        문제: 협업을 위한 환경 설정
      </h3><ol>
<li>브랜치를 관리하기 위한 규칙이 필요</li>
<li>ci를 위한 설정이 필요</li>
</ol>

      <h3 id="해결-방법">
        <a name="해결-방법" class="anchor" href="#해결-방법">
          <span class="header-link"></span>
        </a>
        해결 방법
      </h3><ol>
<li>브랜치 관리 규칙을 정함<ul>
<li>main: 배포용 브랜치<ul>
<li>push 불가능</li>
</ul>
</li>
<li>pull request 규칙 설정<ul>
<li>승인을 받아야만 merge 가능</li>
<li>코드 소유자의 리뷰가 필요</li>
</ul>
</li>
</ul>
</li>
<li>github action을 통해 ci를 설정함<ul>
<li>go 프로젝트 빌드/테스트가 성공해야만 merge 가능<ul>
<li>[TODO] 기존의 테스트 코드들이 mock을 사용하지 않아서 테스트가 불가능한 상황 해소 필요</li>
</ul>
</li>
<li>docker 빌드가 성공해야만 merge 가능</li>
</ul>
</li>
</ol>
<pre><code class="language-yaml">name: CI

on:
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.22

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1

    - name: Dockerfile main_server 빌드
      run: docker build -t main_server:latest .
      working-directory: myapp

    - name: Build with docker-compose
      run: docker-compose up -d
      working-directory: myapp

    - name: Test
      run: go test ./...
      working-directory: myapp

    - name: Build
      run: go build ./...
      working-directory: myapp
</code></pre>
<hr>

      <h3 id="문제:-azure에-컨테이너를-통한-배포">
        <a name="문제:-azure에-컨테이너를-통한-배포" class="anchor" href="#문제:-azure에-컨테이너를-통한-배포">
          <span class="header-link"></span>
        </a>
        문제: azure에 컨테이너를 통한 배포
      </h3><ul>
<li>컨테이너에 앞서 이에 포함된 main_server를 acr(azure container registry)에 올리는 과정에서 문제가 발생함.<ul>
<li><a target="_self" href="https://github.com/kaestro/ChatApplication/wiki/Docker%EB%A5%BC-%ED%86%B5%ED%95%9C-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%83%9D%EC%84%B1" title="null">Docker를 통한 어플리케이션 생성 wiki</a></li>
<li><a target="_self" href="https://github.com/kaestro/ChatApplication/wiki/Azure-Container-Registry" title="null">Azure Container Registry</a></li>
</ul>
</li>
</ul>

      <h3 id="해결-방법">
        <a name="해결-방법" class="anchor" href="#해결-방법">
          <span class="header-link"></span>
        </a>
        해결 방법
      </h3><ul>
<li>기존에 acr의 이름이 너무 길어서 camelCase를 사용했던 것이 문제였음. docker는 push할 때 대/소문자가 있을 경우 인증 오류를 발생시킬 수 있음.</li>
<li><a target="_self" href="https://learn.microsoft.com/ko-kr/azure/container-registry/container-registry-faq#az-acr-login-succeeds-but-docker-fails-with-error--unauthorized--authentication-required" title="null">공식문서</a></li>
<li>기존의 purmirContainerRegistry를 purmir로 변경함.</li>
</ul>
<hr>

      <h3 id="kubernetes를-통한-배포">
        <a name="kubernetes를-통한-배포" class="anchor" href="#kubernetes를-통한-배포">
          <span class="header-link"></span>
        </a>
        Kubernetes를 통한 배포
      </h3>
      <h3 id="문제:-kubernetes로-로컬에-클러스터를-생성한-상태에서-요청이-이루어지지-않고-있음.">
        <a name="문제:-kubernetes로-로컬에-클러스터를-생성한-상태에서-요청이-이루어지지-않고-있음." class="anchor" href="#문제:-kubernetes로-로컬에-클러스터를-생성한-상태에서-요청이-이루어지지-않고-있음.">
          <span class="header-link"></span>
        </a>
        문제: kubernetes로 로컬에 클러스터를 생성한 상태에서 요청이 이루어지지 않고 있음.
      </h3>
      <h3 id="해결-방법">
        <a name="해결-방법" class="anchor" href="#해결-방법">
          <span class="header-link"></span>
        </a>
        해결 방법
      </h3><ul>
<li>log를 일단 읽어야 문제 해결이 가능할 것 같음.</li>
<li>kubernetes에 대한 이해 필요</li>
<li>혹은 kubernetes 이외의 방법을 통한 배포를 고려해야할 수도 있음.</li>
</ul>
</div><div style="display:flex;flex-direction:column;gap:1em"><div><a href="/개발일지/ChatApplication Review(2)">이전 포스트: <!-- -->ChatApplication Review(2)</a></div><div style="text-align:right"><a href="/개발일지/ChatApplication Review(4)">다음 포스트: <!-- -->ChatApplication Review(4)</a></div></div><div><button id="go-home" class="home-button-container">Home</button></div><div><button type="button" id="go-top" class="scroll-top" aria-label="top"></button></div><div><button type="button" id="go-bottom" class="scroll-bottom" aria-label="bottom"></button></div></div><hr/></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postDataJson":{"postName":"2024-03-06-Chat Application review(3)","fullPath":"/home/runner/work/kaestro.github.io/kaestro.github.io/_posts/개발/개발일지/Chat Application 개발일지/2024-03-06-Chat Application review(3).md","category":"개발일지","title":"ChatApplication Review(3)","subtitle":"팀원 모집, 확장성 높은 디자인, CI/CD","content":"\n\n## 목차\n\n1. 느낀 점\n2. 진행 내용\n3. 문제 및 해결 방법\n\n---\n\n## 느낀 점\n\n---\n\n## 진행 내용\n\n* 추가 진행에서 협업할 인원 모집\n* 채팅 기능을 위한 모듈들의 작성\n* 설계 조건 맞추기 위한 이론적인 구상\n* 협업을 위한 환경 설정\n\n---\n\n## 문제 및 해결 방법\n\n### 문제 요구 스펙 관련해서 Redis와 같은 세션을 여러개 사용해야할 가능성이 높다는 것을 확인\n\n* RedisStore가 고정적으로 하나의 Redis와의 연결만을 생성할 수 있었음.\n\n### 해결 방법\n\n* StoreFactory를 만들고, RedisStoreFactory를 분리.\n* RedisStoreFactory가 추후에 여러가지 Redis연결을 생성하는 것이 용이하도록 구성함.\n\n```go\ntype RedisStoreFactory struct{}\n\nfunc (factory *RedisStoreFactory) Create(sessionTypeNum SessionType) SessionStore {\n\tvar store SessionStore\n\tif sessionTypeNum == LoginSession {\n\t\tredisAddr := os.Getenv(\"REDIS_ADDR\")\n\t\tif redisAddr == \"\" {\n\t\t\tredisAddr = \"localhost:6379\" // default value\n\t\t}\n\n\t\tstore = \u0026RedisStore{\n\t\t\tclient: redis.NewClient(\u0026redis.Options{\n\t\t\t\tAddr:     redisAddr,\n\t\t\t\tPassword: \"redisPassword\", // no password set\n\t\t\t\tDB:       0,               // use default DB\n\t\t\t}),\n\t\t}\n\t} else if sessionTypeNum == OtherSession {\n\t\tpanic(\"Unauthorized session type number given to RedisStoreFactory.\")\n\t}\n\treturn store\n}\n```\n\n---\n\n### 문제: 여러가지 측면에서 다른 사람의 도움이 있으면 속도가 빨라질 것 같다는 생각이 듬\n\n1. 설계적인 측면에서 second opinion이 필요함.\n2. 코드 리뷰를 통해 유지보수성을 높일 필요가 있음.\n3. 작성해야하는 코드의 양이 많아짐.\n\n### 해결 방법\n\n- 커뮤니티에 모집글을 게시\n- 연락이 온 사람과 화상 미팅 진행\n  - 2명 모집.\n  - 일주일간 진행해보고 계속할 지 여부에 대해 결정하기로 함.\n\n\n---\n\n### 문제: 협업을 위한 환경 설정\n\n1. 브랜치를 관리하기 위한 규칙이 필요\n2. ci를 위한 설정이 필요\n\n\n### 해결 방법\n\n1. 브랜치 관리 규칙을 정함\n\t* main: 배포용 브랜치\n    \t* push 불가능\n\t* pull request 규칙 설정\n\t\t* 승인을 받아야만 merge 가능\n\t\t* 코드 소유자의 리뷰가 필요\n2. github action을 통해 ci를 설정함\n\t* go 프로젝트 빌드/테스트가 성공해야만 merge 가능\n\t\t* [TODO] 기존의 테스트 코드들이 mock을 사용하지 않아서 테스트가 불가능한 상황 해소 필요\n\t* docker 빌드가 성공해야만 merge 가능\n\n```yaml\nname: CI\n\non:\n  pull_request:\n    branches: [ main ]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/checkout@v2\n\n    - name: Set up Go\n      uses: actions/setup-go@v2\n      with:\n        go-version: 1.22\n\n    - name: Set up Docker Buildx\n      uses: docker/setup-buildx-action@v1\n\n    - name: Dockerfile main_server 빌드\n      run: docker build -t main_server:latest .\n      working-directory: myapp\n\n    - name: Build with docker-compose\n      run: docker-compose up -d\n      working-directory: myapp\n\n    - name: Test\n      run: go test ./...\n      working-directory: myapp\n\n    - name: Build\n      run: go build ./...\n      working-directory: myapp\n```\n\n---\n\n### 문제: azure에 컨테이너를 통한 배포\n\n* 컨테이너에 앞서 이에 포함된 main_server를 acr(azure container registry)에 올리는 과정에서 문제가 발생함.\n  * [Docker를 통한 어플리케이션 생성 wiki](https://github.com/kaestro/ChatApplication/wiki/Docker%EB%A5%BC-%ED%86%B5%ED%95%9C-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%83%9D%EC%84%B1)\n  * [Azure Container Registry](https://github.com/kaestro/ChatApplication/wiki/Azure-Container-Registry)\n\n### 해결 방법\n\n* 기존에 acr의 이름이 너무 길어서 camelCase를 사용했던 것이 문제였음. docker는 push할 때 대/소문자가 있을 경우 인증 오류를 발생시킬 수 있음.\n* [공식문서](https://learn.microsoft.com/ko-kr/azure/container-registry/container-registry-faq#az-acr-login-succeeds-but-docker-fails-with-error--unauthorized--authentication-required)\n* 기존의 purmirContainerRegistry를 purmir로 변경함.\n\n---\n\n### Kubernetes를 통한 배포\n\n### 문제: kubernetes로 로컬에 클러스터를 생성한 상태에서 요청이 이루어지지 않고 있음.\n\n### 해결 방법\n\n* log를 일단 읽어야 문제 해결이 가능할 것 같음.\n* kubernetes에 대한 이해 필요\n* 혹은 kubernetes 이외의 방법을 통한 배포를 고려해야할 수도 있음.","layout":"series","recommended":false,"data":{"layout":"series","series":"Chat Application 개발일지","seriesIndex":3,"classes":"wide","title":"ChatApplication Review(3)","subtitle":"팀원 모집, 확장성 높은 디자인, CI/CD","date":"2024-03-06T00:00:00.000Z","categories":"개발일지"}},"title":"ChatApplication Review(3)","category":"개발일지","categories":["ETC","개발이야기","개발일지","디자인패턴","Algorithm","서평","WeeklyPosts","신변잡기","게임이야기"],"adjacentPosts":{"prev":{"title":"ChatApplication Review(2)","category":"개발일지"},"next":{"title":"ChatApplication Review(4)","category":"개발일지"}}},"__N_SSG":true},"page":"/[category]/[title]","query":{"category":"개발일지","title":"ChatApplication Review(3)"},"buildId":"4n-fl_RCrq53WZFFUxusB","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>